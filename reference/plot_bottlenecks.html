<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Plot MCMC Bottlenecks by Node or Family — plot_bottlenecks • samOptiPro</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot MCMC Bottlenecks by Node or Family — plot_bottlenecks"><meta name="description" content="Generates a comprehensive diagnostic panel of MCMC bottlenecks using
efficiency and convergence metrics computed per node or node family.
The function can optionally restrict analyses to nodes that are
effectively sampled (i.e. have associated samplers in the NIMBLE
configuration), identified automatically via conf.mcmc$getSamplers().
It produces publication-ready figures of:
Median Algorithmic Efficiency (AE = ESS/iter) by node family;
Median Computational Efficiency (CE = ESS/s) by node family;
Worst targets by CE (lowest ESS/s);
Median or worst \(\hat{R}\) (Gelman–Rubin) by node or family.


The function saves each plot both as PDF and PNG in the specified output directory.
Bar widths and spacing are optimized for compact presentation."><meta property="og:description" content="Generates a comprehensive diagnostic panel of MCMC bottlenecks using
efficiency and convergence metrics computed per node or node family.
The function can optionally restrict analyses to nodes that are
effectively sampled (i.e. have associated samplers in the NIMBLE
configuration), identified automatically via conf.mcmc$getSamplers().
It produces publication-ready figures of:
Median Algorithmic Efficiency (AE = ESS/iter) by node family;
Median Computational Efficiency (CE = ESS/s) by node family;
Worst targets by CE (lowest ESS/s);
Median or worst \(\hat{R}\) (Gelman–Rubin) by node or family.


The function saves each plot both as PDF and PNG in the specified output directory.
Bar widths and spacing are optimized for compact presentation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">samOptiPro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RomualdEcoStats/samOptiPro-core" aria-label="Source on GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Plot MCMC Bottlenecks by Node or Family</h1>
      <small class="dont-index">Source: <a href="https://github.com/RomualdEcoStats/samOptiPro-core/blob/main/R/plots.R" class="external-link"><code>R/plots.R</code></a></small>
      <div class="d-none name"><code>plot_bottlenecks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates a comprehensive diagnostic panel of MCMC bottlenecks using
efficiency and convergence metrics computed per node or node family.
The function can optionally restrict analyses to nodes that are
effectively sampled (i.e. have associated samplers in the NIMBLE
configuration), identified automatically via <code>conf.mcmc$getSamplers()</code>.</p>
<p>It produces publication-ready figures of:</p><ul><li><p>Median <em>Algorithmic Efficiency</em> (AE = ESS/iter) by node family;</p></li>
<li><p>Median <em>Computational Efficiency</em> (CE = ESS/s) by node family;</p></li>
<li><p>Worst targets by CE (lowest ESS/s);</p></li>
<li><p>Median or worst \(\hat{R}\) (Gelman–Rubin) by node or family.</p></li>
</ul><p>The function saves each plot both as PDF and PNG in the specified output directory.
Bar widths and spacing are optimized for compact presentation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">plot_bottlenecks</span><span class="op">(</span></span>
<span>  <span class="va">diag_tbl</span>,</span>
<span>  out_dir <span class="op">=</span> <span class="st">"outputs/diagnostics"</span>,</span>
<span>  top_k <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  rhat_ref <span class="op">=</span> <span class="fl">1.05</span>,</span>
<span>  sampled_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  conf.mcmc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  samples_ml <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  make_esss_targets <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_esss_families <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_time_families <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_rhat_hist_targets <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_rhat_worst_targets <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_rhat_median_families <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  make_hist_ae_families <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  make_hist_ce_families <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-diag-tbl">diag_tbl<a class="anchor" aria-label="anchor" href="#arg-diag-tbl"></a></dt>
<dd><p><code>data.frame</code> or <code>tibble</code> containing diagnostics per target node.
Must include columns such as <code>target</code>, <code>Family</code>, <code>ESS</code>, <code>ESS_per_sec</code>, and optionally <code>Rhat</code>.</p></dd>


<dt id="arg-out-dir">out_dir<a class="anchor" aria-label="anchor" href="#arg-out-dir"></a></dt>
<dd><p>Character string; path to output directory for saving figures
(default: <code>"outputs/diagnostics"</code>). Will be created recursively if missing.</p></dd>


<dt id="arg-top-k">top_k<a class="anchor" aria-label="anchor" href="#arg-top-k"></a></dt>
<dd><p>Integer; number of worst or best nodes to display (default: <code>20L</code>).</p></dd>


<dt id="arg-rhat-ref">rhat_ref<a class="anchor" aria-label="anchor" href="#arg-rhat-ref"></a></dt>
<dd><p>Numeric; reference threshold for Gelman–Rubin \(\hat{R}\) (default: <code>1.05</code>).</p></dd>


<dt id="arg-sampled-only">sampled_only<a class="anchor" aria-label="anchor" href="#arg-sampled-only"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, restricts plots to nodes that have an
explicit sampler in <code>conf.mcmc</code> and are present in <code>samples_ml</code>. Default: <code>FALSE</code>.</p></dd>


<dt id="arg-conf-mcmc">conf.mcmc<a class="anchor" aria-label="anchor" href="#arg-conf-mcmc"></a></dt>
<dd><p>NIMBLE MCMC configuration object, typically produced by
<code>configureMCMC(model, ...)</code> or stored as <code>build_fn()$conf</code>. Used to extract
sampler-attached target nodes when <code>sampled_only = TRUE</code>.</p></dd>


<dt id="arg-samples-ml">samples_ml<a class="anchor" aria-label="anchor" href="#arg-samples-ml"></a></dt>
<dd><p>Optional MCMC list (as returned by <code>runMCMC(..., nchains &gt; 1)</code>),
used to match sampler targets with actual sample column names.</p></dd>


<dt id="arg-make-esss-targets">make_esss_targets<a class="anchor" aria-label="anchor" href="#arg-make-esss-targets"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, produces barplot of worst targets
by computational efficiency (default: <code>TRUE</code>).</p></dd>


<dt id="arg-make-esss-families">make_esss_families<a class="anchor" aria-label="anchor" href="#arg-make-esss-families"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, produces barplot of median
algorithmic efficiency (AE) by node family (default: <code>TRUE</code>).</p></dd>


<dt id="arg-make-time-families">make_time_families<a class="anchor" aria-label="anchor" href="#arg-make-time-families"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, produces barplot of median
computational efficiency (CE) by node family (default: <code>TRUE</code>).</p></dd>


<dt id="arg-make-rhat-hist-targets">make_rhat_hist_targets<a class="anchor" aria-label="anchor" href="#arg-make-rhat-hist-targets"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, produces barplot of median
Rhat per family (default: <code>TRUE</code>).</p></dd>


<dt id="arg-make-rhat-worst-targets">make_rhat_worst_targets<a class="anchor" aria-label="anchor" href="#arg-make-rhat-worst-targets"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, produces barplot of the
worst Rhat targets (default: <code>TRUE</code>).</p></dd>


<dt id="arg-make-rhat-median-families">make_rhat_median_families<a class="anchor" aria-label="anchor" href="#arg-make-rhat-median-families"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, produces an alias
of the median Rhat-by-family plot (default: <code>TRUE</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly returns a named <code>list</code> of ggplot objects:</p><ul><li><p><code>bar_family_algorithmic_eff</code> — Median AE by family;</p></li>
<li><p><code>bar_family_computational_eff</code> — Median CE by family;</p></li>
<li><p><code>bar_target_CE</code> — Worst targets by CE;</p></li>
<li><p><code>rhat_family_template</code> — Median Rhat by family;</p></li>
<li><p><code>rhat_worst_targets</code> — Worst targets by Rhat.</p></li>
</ul><p>Each plot is also saved in <code>out_dir</code> as both <code>.pdf</code> and <code>.png</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is a core visualization tool for diagnosing performance
bottlenecks in large hierarchical Bayesian models (e.g., SAM-like or
GEREM-type stock assessment models). It integrates runtime, efficiency,
and convergence metrics in a standardized panel of plots, suitable for
benchmarking, model comparison, or publication figures.</p>
<p>When <code>sampled_only = TRUE</code>, it automatically extracts the list of stochastic
nodes (targets) from <code>conf.mcmc$getSamplers()</code> and intersects them with the
variable names present in <code>samples_ml</code>. This ensures only stochastically
sampled nodes are visualized, excluding lifted or deterministic intermediates.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="identify_bottlenecks_family.html">identify_bottlenecks_family</a></code>,
<code><a href="profile_sampler_times.html">profile_sampler_times</a></code>,
<code><a href="run_structure_and_hmc_test.html">run_structure_and_hmc_test</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example assuming an existing NIMBLE configuration and MCMC results:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">plot_bottlenecks</span><span class="op">(</span></span></span>
<span class="r-in"><span>  diag_tbl     <span class="op">=</span> <span class="va">diag_tbl</span>,</span></span>
<span class="r-in"><span>  conf.mcmc    <span class="op">=</span> <span class="va">conf.mcmc</span>,</span></span>
<span class="r-in"><span>  samples_ml   <span class="op">=</span> <span class="va">samples_ml</span>,</span></span>
<span class="r-in"><span>  sampled_only <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  out_dir      <span class="op">=</span> <span class="st">"outputs/diagnostics"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Romuald Hounyeme, Etienne Rivot.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

