---
title: "samOptiPro — Diagnostics, HMC et goulots d'étranglement"
author: "samOptiPro auto-builder"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{samOptiPro mega vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment  = "#>",
  fig.width  = 7,
  fig.height = 5
)
```

# Introduction

Cette vignette regroupe les principales fonctions de `samOptiPro` liées à :

- la structure du modèle, les diagnostics et HMC/NUTS ;
- l'évaluation des performances et l'identification des goulots d'étranglement ;
- les moniteurs et les fonctions de "runner" haut niveau.

Chaque sous-section est extraite automatiquement des vignettes individuelles générées pour chaque fonction.


# Diagnostics / structure / HMC


## diagnose_model_structure

*(Extrait automatiquement de `fun_diagnose_model_structure.Rmd`.)*

Diagnose model structure, dependencies, and per-sampler time (parameter- and family-level)

## Arguments
```text
model, include_data, removed_nodes, ignore_patterns, make_plots, output_dir, save_csv, node_of_interest, sampler_times, sampler_times_unit, auto_profile, profile_niter, profile_burnin, profile_thin, profile_seed, np, by_family, family_stat, time_normalize, only_family_plots, ...
```

## Example
```r
# diagnose_model_structure()
```


## run_structure_and_hmc_test

*(Extrait automatiquement de `fun_run_structure_and_hmc_test.Rmd`.)*

Run structural diagnostics and (optional) HMC/NUTS smoke test

## Arguments
```text
build_fn, include_data, try_hmc, niter, nburnin, seed
```

## Example
```r
# run_structure_and_hmc_test()
```


## configure_hmc_safely

*(Extrait automatiquement de `fun_configure_hmc_safely_bis.Rmd`.)*

Configure and run HMC/NUTS safely (global / subset / auto)

## Arguments
```text
build_fn, niter, nburnin, thin, nchains, monitors, nuts_mode, nuts_nodes, enable_WAIC, buildDerivs, compiler_cores, show_compiler_output, project_name, out_dir, inits, save_samples
```

## Example
```r
# configure_hmc_safely_bis()
```


## configure_hmc_safely_bis

*(Extrait automatiquement de `fun_configure_hmc_safely_bis.Rmd`.)*

Configure and run HMC/NUTS safely (global / subset / auto)

## Arguments
```text
build_fn, niter, nburnin, thin, nchains, monitors, nuts_mode, nuts_nodes, enable_WAIC, buildDerivs, compiler_cores, show_compiler_output, project_name, out_dir, inits, save_samples
```

## Example
```r
# configure_hmc_safely_bis()
```


## test_strategy

*(Extrait automatiquement de `fun_test_strategy_family_fast.Rmd`.)*

Fast strategy testing for sampler plans (family-level, with optional full-model HMC/NUTS)

## Arguments
```text
build_fn, monitors, try_hmc, nchains, pilot_niter, pilot_burnin, thin, out_dir, nbot, strict_scalar_seq, strict_block_seq, force_families, force_nodes, force_union, ask, ask_before_hmc, block_max, slice_control, rw_control, rwblock_control, af_slice_control, slice_max_contractions
```

## Example
```r
# test_strategy_family_fast()
```


## test_strategy_family

*(Extrait automatiquement de `fun_test_strategy_family_fast.Rmd`.)*

Fast strategy testing for sampler plans (family-level, with optional full-model HMC/NUTS)

## Arguments
```text
build_fn, monitors, try_hmc, nchains, pilot_niter, pilot_burnin, thin, out_dir, nbot, strict_scalar_seq, strict_block_seq, force_families, force_nodes, force_union, ask, ask_before_hmc, block_max, slice_control, rw_control, rwblock_control, af_slice_control, slice_max_contractions
```

## Example
```r
# test_strategy_family_fast()
```


## test_strategy_family_fast

*(Extrait automatiquement de `fun_test_strategy_family_fast.Rmd`.)*

Fast strategy testing for sampler plans (family-level, with optional full-model HMC/NUTS)

## Arguments
```text
build_fn, monitors, try_hmc, nchains, pilot_niter, pilot_burnin, thin, out_dir, nbot, strict_scalar_seq, strict_block_seq, force_families, force_nodes, force_union, ask, ask_before_hmc, block_max, slice_control, rw_control, rwblock_control, af_slice_control, slice_max_contractions
```

## Example
```r
# test_strategy_family_fast()
```


## compute_diag_from_mcmc

*(Extrait automatiquement de `fun_compute_diag_from_mcmc_vect.Rmd`.)*

Compute Diagnostics from MCMC Samples (massively scalable)

## Arguments
```text
samples, runtime_s, compute_rhat, ess_for, ignore_patterns, cols_by, warn_mem_gb, step_timeout_s, runtime_is_total, use_posterior, target_block_ram_gb, verbose
```

## Example
```r
# compute_diag_from_mcmc_vect()
```


## compute_diag_from_mcmc_vect

*(Extrait automatiquement de `fun_compute_diag_from_mcmc_vect.Rmd`.)*

Compute Diagnostics from MCMC Samples (massively scalable)

## Arguments
```text
samples, runtime_s, compute_rhat, ess_for, ignore_patterns, cols_by, warn_mem_gb, step_timeout_s, runtime_is_total, use_posterior, target_block_ram_gb, verbose
```

## Example
```r
# compute_diag_from_mcmc_vect()
```


## diagnostics_by_target

*(Extrait automatiquement de `fun_diagnostics_by_target.Rmd`.)*

Target-level diagnostics (time + optional step-size proxy)

## Arguments
```text
build_fn, opts, niter, samples
```

## Example
```r
# diagnostics_by_target()
```


# Évaluation & goulots d’étranglement


## assess_performance

*(Extrait automatiquement de `fun_assess_performance.Rmd`.)*

Compute per-parameter and global performance diagnostics from an MCMC

## Arguments
```text
samples, runtime_s, rhat_thresh
```

## Example
```r
# assess_performance()
```


## identify_bottlenecks

*(Extrait automatiquement de `fun_identify_bottlenecks_family.Rmd`.)*

Identify bottlenecks by parameter stats::family(medians within families)

## Arguments
```text
samples, runtime_s, ess_threshold, sampler_params, model, mcmc_conf, ignore_patterns, strict_sampler_only, auto_configure, rhat_threshold, ess_per_s_min
```

## Example
```r
# identify_bottlenecks_family()
```


## identify_bottlenecks_family

*(Extrait automatiquement de `fun_identify_bottlenecks_family.Rmd`.)*

Identify bottlenecks by parameter stats::family(medians within families)

## Arguments
```text
samples, runtime_s, ess_threshold, sampler_params, model, mcmc_conf, ignore_patterns, strict_sampler_only, auto_configure, rhat_threshold, ess_per_s_min
```

## Example
```r
# identify_bottlenecks_family()
```


## plot_bottlenecks

*(Extrait automatiquement de `fun_plot_bottlenecks_fast.Rmd`.)*

Fast bottleneck plots (samplers-only) for large models

## Arguments
```text
diag_tbl, sampled_only, conf.mcmc, samples_ml, out_dir
```

## Example
```r
# plot_bottlenecks_fast()
```


## plot_bottlenecks_index

*(Extrait automatiquement de `fun_plot_bottlenecks_index.Rmd`.)*

Plot diagnostics for stochastic sampler targets (strict) + all-nodes panels

## Arguments
```text
diag_tbl, out_dir, top_k, n_worst, bins, rhat_ref, make_bar_ae_median_all, make_bar_ce_median_all, make_bar_ce_worst_all, make_bar_rhat_worst, make_bar_ess_q5, make_hist_ce, make_hist_ae
```

## Example
```r
# plot_bottlenecks_index()
```


## plot_family_ess_bar

*(Extrait automatiquement de `fun_plot_family_ess_bar.Rmd`.)*

Family-level ESS bar plot (harmonised style)

## Arguments
```text
samples, runtime_s, sampler_params, model, mcmc_conf, samplers_df, ignore_patterns, strict_sampler_only
```

## Example
```r
# plot_family_ess_bar()
```


## plot_family_rhat_bar

*(Extrait automatiquement de `fun_plot_family_rhat_bar.Rmd`.)*

Family-level Rhat bar plot (harmonised style)

## Arguments
```text
samples, runtime_s, sampler_params, model, mcmc_conf, samplers_df, ignore_patterns, strict_sampler_only, rhat_threshold
```

## Example
```r
# plot_family_rhat_bar()
```


## plot_convergence_checks

*(Extrait automatiquement de `fun_plot_convergence_checks.Rmd`.)*

Plot convergence diagnostics (R-hat & traces) with family-level R-hat bars

## Arguments
```text
samples, out_dir, top_k_rhat, top_k_aelow, runtime_s, rhat_ref, make_rhat_hist, make_traces_rhat, make_traces_ae, make_rhat_family_bars
```

## Example
```r
# plot_convergence_checks()
```


## plot_convergence_rhat_sampled_fast

*(Extrait automatiquement de `fun_plot_convergence_rhat_sampled_fast.Rmd`.)*

Fast convergence plots for R-hat (samplers-only), thresholded

## Arguments
```text
diag_tbl, threshold, sampled_only, conf.mcmc, samples_ml, out_dir, top_k, prefer_split
```

## Example
```r
# plot_convergence_rhat_sampled_fast()
```


## plot_strategies_from_test_result_fast

*(Extrait automatiquement de `fun_plot_strategies_from_test_result_fast.Rmd`.)*

Plot strategy comparisons from test_strategy_family_fast results (fast path)

## Arguments
```text
res, out_dir, per, top_k, top_by, export_rds, width, height, dpi
```

## Example
```r
# plot_strategies_from_test_result_fast()
```


## plot_strategies_from_test_result_hmc_fast

*(Extrait automatiquement de `fun_plot_strategies_from_test_result_hmc_fast.Rmd`.)*

@export

## Arguments
```text
res, out_dir, per, top_k, top_by, show_rhat_label
```

## Example
```r
# plot_strategies_from_test_result_hmc_fast()
```


## enrich_hmc_diag_tbl_for_plots

*(Extrait automatiquement de `fun_enrich_hmc_diag_tbl_for_plots.Rmd`.)*

NA

## Arguments
```text
res
```

## Example
```r
# enrich_hmc_diag_tbl_for_plots()
```


# Moniteurs / runners


## default_monitors

*(Extrait automatiquement de `fun_default_monitors.Rmd`.)*

NA

## Arguments
```text
model, opts
```

## Example
```r
# default_monitors()
```


## ensure_monitors_exist

*(Extrait automatiquement de `fun_ensure_monitors_exist.Rmd`.)*

Ensure monitors exist on the model (variable-aware)

## Arguments
```text
model, monitors
```

## Example
```r
# ensure_monitors_exist()
```


## run_baseline_config

*(Extrait automatiquement de `fun_run_baseline_config.Rmd`.)*

Run baseline RW/Slice with robust compile/run

## Arguments
```text
build_fn, niter, nburnin, thin, monitors, nchains, opts
```

## Example
```r
# run_baseline_config()
```


## run_baseline_coda

*(Extrait automatiquement de `fun_run_baseline_coda.Rmd`.)*

Run baseline et retourne un mcmc.list fusionne (samples + samples2)

## Arguments
```text
build_fn, niter, nburnin, thin, monitors, nchains, drop_loglik, opts
```

## Example
```r
# run_baseline_coda()
```


## run_hmc_all_nodes

*(Extrait automatiquement de `fun_run_hmc_all_nodes.Rmd`.)*

Run HMC/NUTS where possible; fallback samplers for uncovered nodes

## Arguments
```text
build_fn, niter, nburnin, thin, monitors, nchains, opts
```

## Example
```r
# run_hmc_all_nodes()
```


## build_conf_with_monitors

*(Extrait automatiquement de `fun_build_conf_with_monitors.Rmd`.)*

Build a fresh MCMC configuration with automatic monitors if missing

## Arguments
```text
model, monitors, opts
```

## Example
```r
# build_conf_with_monitors()
```


## as_mcmc_list

*(Extrait automatiquement de `fun_.safe_as_mcmc_list.Rmd`.)*

NA

## Arguments
```text
x, start, thin
```

## Example
```r
# .safe_as_mcmc_list()
```


## as_mcmc_list_sop

*(Extrait automatiquement de `fun_as_mcmc_list_sop.Rmd`.)*

Convert various sample formats to coda::mcmc.list (optionally merging samples2)

## Arguments
```text
samples, samples2, drop_loglik, thin
```

## Example
```r
# as_mcmc_list_sop()
```


## merge_mcmc_samples

*(Extrait automatiquement de `fun_merge_mcmc_samples.Rmd`.)*

Merge `res$samples` and `res$samples2` into a single `mcmc.list`

## Arguments
```text
res
```

## Example
```r
# merge_mcmc_samples()
```

