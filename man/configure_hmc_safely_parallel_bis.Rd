% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnostics.R
\name{configure_hmc_safely_parallel_bis}
\alias{configure_hmc_safely_parallel_bis}
\title{Configure + run HMC/NUTS in parallel (large-model safe, PSOCK)}
\usage{
configure_hmc_safely_parallel_bis(
  build_fn,
  niter,
  nburnin,
  thin,
  nchains,
  monitors,
  inits = NULL,
  enable_WAIC = FALSE,
  show_compiler_output = FALSE,
  seed = 1L,
  n_cores = nchains,
  samplesAsCodaMCMC = TRUE,
  opts = NULL
)
}
\arguments{
\item{build_fn}{Function OR single string (function name). The builder is resolved on workers
using namespace/globalEnv/object fallback (same philosophy as baseline_bis).
It must return either a nimble model, or a list with at least \verb{$model} (and optionally \verb{$cmodel}).}

\item{niter, nburnin, thin}{MCMC run controls.}

\item{nchains}{Number of chains.}

\item{monitors}{Character vector of monitors passed to \code{configureHMC()}.}

\item{inits}{Optional list of inits (length = nchains) or a single init list. If provided, the worker
will try calling the builder with \verb{inits=} (fallback to builder without it if not supported).}

\item{enable_WAIC}{Logical passed to \code{configureHMC()}.}

\item{show_compiler_output}{Logical passed to Nimble compilation.}

\item{seed}{Integer seed.}

\item{n_cores}{Number of PSOCK workers (defaults to nchains).}

\item{samplesAsCodaMCMC}{Logical; if TRUE returns \code{coda::mcmc.list}.}

\item{opts}{Advanced options (same family as baseline_bis):
\itemize{
\item cluster_type ("PSOCK"), outfile (""), worker_libpaths, worker_packages
\item build_fn_text, build_fn_name, build_fn_ns
\item build_fn_object, builder_env_names
\item resetFunctions (default FALSE recommended here), gc_worker (TRUE)
\item mcmc_time (TRUE), progressBar (FALSE)
\item conf_return: "none" | "chain1" | "by_chain" | "rds"
\itemize{
\item "chain1"/"by_chain": attempts to return \code{conf_hmc} directly (may fail serialization on some setups)
\item "rds": saves conf to disk on worker and returns paths (recommended if you need conf)
}
\item conf_dir: directory used when conf_return="rds" (default tempdir()).
}}
}
\value{
list with:
\itemize{
\item samples (list of matrices or coda::mcmc.list)
\item runtime_s (wall time over the whole parallel run)
\item runtime_by_chain
\item sampler_times (if available)
\item conf (optional, depending on opts$conf_return)
\item conf_by_chain (optional)
\item conf_paths (optional when conf_return="rds")
}
}
\description{
Parallel wrapper around \code{nimbleHMC::configureHMC()} aligned with the worker strategy of
\code{run_baseline_config_parallel_bis}: each worker resolves \code{build_fn}, builds the \emph{R} model,
compiles the project (compiled model), configures HMC, builds & compiles the MCMC, then runs
and returns samples + timing.

Important technical points (to avoid “repetitions” and post-run hangs):
\itemize{
\item The model is compiled once per worker (\code{cmodel}), then the MCMC is compiled against that compiled project.
\item No monitor mutation after MCMC build (monitors are passed only via \code{configureHMC()}).
\item Returning \code{conf} objects can fail due to serialization (external pointers). This function supports
safe modes via \code{opts$conf_return}.
}
}
