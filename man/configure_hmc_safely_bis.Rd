% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnostics.R
\name{configure_hmc_safely_bis}
\alias{configure_hmc_safely_bis}
\title{Configure and run HMC/NUTS safely (global / subset / auto)}
\usage{
configure_hmc_safely_bis(
  build_fn,
  niter,
  nburnin,
  thin,
  nchains,
  monitors = NULL,
  nuts_mode = c("all", "subset", "auto", "none"),
  nuts_nodes = NULL,
  enable_WAIC = FALSE,
  buildDerivs = TRUE,
  compiler_cores = max(1L, parallel::detectCores(TRUE)\%/\%2L),
  show_compiler_output = TRUE,
  project_name = NULL,
  out_dir = NULL,
  inits = NULL,
  save_samples = TRUE
)
}
\arguments{
\item{niter}{integer. Total iterations.}

\item{nburnin}{integer (>= 0). Burn-in iterations (0 allowed).}

\item{thin}{integer (>= 1). Thinning interval.}

\item{nchains}{integer (>= 1). Number of chains.}

\item{monitors}{character vector or NULL. Passed through to building and/or global HMC config.}

\item{nuts_mode}{character. One of \code{c("all","subset","auto","none")}:
\itemize{
\item \code{"all"}: global NUTS via \code{nimbleHMC::configureHMC(model, monitors=..., enableWAIC=..., buildDerivs=...)}.
\item \code{"subset"}: NUTS only on \code{nuts_nodes} via \code{nimbleHMC::configureHMC(conf, model, nodes=..., ...)}.
\item \code{"auto"}: let \code{nimbleHMC::configureHMC(conf, model, ...)} choose targets automatically.
\item \code{"none"}: do not modify the existing configuration.
}}

\item{nuts_nodes}{character vector of node names (can include indexed forms like \code{"beta[]"}) when \code{nuts_mode="subset"}.}

\item{enable_WAIC}{logical. Only relevant for \code{"all"} (model-signature path).}

\item{buildDerivs}{logical. Passed to \code{nimbleHMC::configureHMC(...)}.}

\item{compiler_cores}{integer. Passed to \code{nimbleOptions(numCompilerCores=...)}.}

\item{show_compiler_output}{logical. Passed to \code{nimbleOptions(showCompilerOutput=...)}.}

\item{project_name}{character or NULL. If non-NULL, sets \code{options(nimbleProjectName=...)} to sanitize the C++ cache.}

\item{out_dir}{character or NULL. If non-NULL, saves a \code{sessionInfo()} log and, optionally, samples as \code{.rds}.}

\item{inits}{NULL or a list of per-chain initial values to pass to \code{runMCMC} (length must match \code{nchains} if provided).}

\item{save_samples}{logical. If TRUE (default) and \code{out_dir} is non-NULL, save \code{samples} as \code{.rds}. If FALSE, skip saving samples.}
}
\value{
A list with elements:
\itemize{
\item \code{conf}: final MCMC configuration (with NUTS/HMC if configured)
\item \code{cmcmc}: compiled MCMC object
\item \code{samples}: \code{coda::mcmc.list} of posterior samples
\item \code{runtime_s}: wall time in seconds
}
}
\description{
Minimal, strict wrapper around NIMBLE + nimbleHMC that:
(1) builds the model,
(2) configures NUTS either globally (model signature),
on a subset of nodes (conf + model + nodes signature),
or in auto mode,
(3) compiles, and (4) runs MCMC.
}
\details{
No per-node fallback like \code{addSampler('NUTS')} is attempted: on error, we stop.
}
