% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/runners.R
\name{run_baseline_config_parallel_bis}
\alias{run_baseline_config_parallel_bis}
\title{Run a baseline NIMBLE MCMC configuration in parallel (robust “large-model” variant)}
\usage{
run_baseline_config_parallel_bis(
  build_fn,
  niter,
  nburnin,
  thin,
  monitors = NULL,
  nchains = 3L,
  seed = 1L,
  n_cores = nchains,
  extra_export = character(0),
  samplesAsCodaMCMC = FALSE,
  export_global = FALSE,
  opts = NULL
)
}
\arguments{
\item{build_fn}{A builder function, or a single character string giving the builder name.
The builder must return a list with at least \code{model} and \code{conf}.}

\item{niter, nburnin, thin}{MCMC settings passed to NIMBLE.}

\item{monitors}{Optional monitor vector (if \code{NULL}, may fall back to \code{parts$monitors}).}

\item{nchains}{Number of parallel chains to run.}

\item{seed}{Base RNG seed (each chain uses \code{seed + chain_id - 1}).}

\item{n_cores}{Number of PSOCK workers.}

\item{extra_export}{Optional additional symbols to export to workers.}

\item{samplesAsCodaMCMC}{Passed to \code{nimble::runMCMC()} fallback (when not using \verb{$run()}).}

\item{export_global}{If \code{TRUE}, exports the whole master \code{.GlobalEnv} (not recommended unless needed).}

\item{opts}{List of advanced options (cluster type, packages, builder injection, timings).}
}
\value{
A list with:
\itemize{
\item \code{samples}: list of per-chain samples (matrix or coda, depending on options),
\item \code{runtime_s}: wall-clock time of the full parallel phase,
\item \code{runtime_by_chain}: numeric vector of per-chain MCMC runtimes,
\item \code{sampler_times}: list of \code{Cmcmc$getTimes()} outputs (if enabled),
\item \code{conf_by_chain}: optional list of \code{nimbleMCMCconf} (if \code{opts$return_conf = TRUE}),
\item \code{opts_effective}: the effective options used.
}
}
\description{
\code{run_baseline_config_parallel_bis()} is the \emph{large-model} counterpart of
\code{run_baseline_config_parallel()}. It is designed to remain stable on very large
NIMBLE models (e.g., >80,000 nodes; WGNAS-scale) and on HPC/cluster environments,
where naïve PSOCK parallelization can trigger memory blow-ups or fail due to
missing closure bindings on workers.

Compared to the non-\verb{_bis} function, this version:
\itemize{
\item supports resolving \code{build_fn} by \emph{name} (character) on workers, including optional namespace lookup;
\item supports injecting \code{build_fn} as text (\code{opts$build_fn_text}) and exporting the \emph{captured environment}
of the builder closure (\code{opts$build_fn_object}, \code{opts$builder_env_names}) to prevent
errors like “objet 'hindcast_' introuvable”;
\item avoids mandatory disk I/O (no log files required), suitable for clusters with restricted write access;
\item times only the MCMC execution phase (optionally using \verb{$run(time=TRUE)}), keeping compilation outside
the per-chain runtime by construction;
\item says memory: optional worker-side \code{gc()} clean-up after each chain to reduce peak usage on large graphs;
\item can optionally return the \emph{actual} \code{nimbleMCMCconf} used on each worker (\code{opts$return_conf = TRUE})
so downstream diagnostics can reuse the exact sampler/monitor configuration.
}

The function assumes that \code{build_fn} returns at least a list with \code{model} and \code{conf}
(plus optional \code{monitors}). The returned object includes \code{samples}, \code{runtime_s},
\code{runtime_by_chain}, and \code{sampler_times}, and optionally \code{conf_by_chain}.
}
